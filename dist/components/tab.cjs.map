{"version":3,"file":"tab.cjs","sources":["../../src/strings/tabString.ts","../../src/strings/tabComponent.ts","../../src/components/tab.ts"],"sourcesContent":["/** @type {string} */\nconst tabString = 'tab';\nexport default tabString;\n","/** @type {string} */\nconst tabComponent = 'Tab';\nexport default tabComponent;\n","/* Native JavaScript for Bootstrap 5 | Tab\n------------------------------------------ */\nimport {\n  emulateTransitionEnd,\n  dispatchEvent,\n  removeClass,\n  hasClass,\n  addClass,\n  querySelector,\n  getElementsByClassName,\n  closest,\n  setAttribute,\n  mouseclickEvent,\n  createCustomEvent,\n  Timer,\n  getInstance,\n  ariaSelected,\n  // ObjectAssign,\n  reflow,\n  isHTMLElement,\n} from '@thednp/shorty';\n\nimport { addListener, removeListener } from '@thednp/event-listener';\n\nimport collapsingClass from '../strings/collapsingClass';\nimport activeClass from '../strings/activeClass';\nimport fadeClass from '../strings/fadeClass';\nimport showClass from '../strings/showClass';\nimport dropdownClasses from '../strings/dropdownClasses';\nimport dataBsToggle from '../strings/dataBsToggle';\nimport tabString from '../strings/tabString';\nimport tabComponent from '../strings/tabComponent';\n\nimport getTargetElement from '../util/getTargetElement';\nimport BaseComponent from './base-component';\nimport type { /* TabOptions, */ TabEvent } from '../interface/tab';\n\n// TAB PRIVATE GC\n// ================\nconst tabSelector = `[${dataBsToggle}=\"${tabString}\"]`;\n\n/**\n * Static method which returns an existing `Tab` instance associated\n * to a target `Element`.\n */\nconst getTabInstance = (element: HTMLElement) => getInstance<Tab>(element, tabComponent);\n\n/** A `Tab` initialization callback. */\nconst tabInitCallback = (element: HTMLElement) => new Tab(element);\n\n// TAB CUSTOM EVENTS\n// =================\nconst showTabEvent = createCustomEvent<TabEvent>(`show.bs.${tabString}`);\nconst shownTabEvent = createCustomEvent<TabEvent>(`shown.bs.${tabString}`);\nconst hideTabEvent = createCustomEvent<TabEvent>(`hide.bs.${tabString}`);\nconst hiddenTabEvent = createCustomEvent<TabEvent>(`hidden.bs.${tabString}`);\n\ninterface TabPrivate {\n  tab: HTMLElement | null;\n  content: HTMLElement | null;\n  currentHeight: number;\n  nextHeight: number;\n}\n\n/**\n * Stores the current active tab and its content\n * for a given `.nav` element.\n */\nconst tabPrivate: Map<HTMLElement, TabPrivate> = new Map();\n\n// TAB PRIVATE METHODS\n// ===================\n/**\n * Executes after tab transition has finished.\n *\n * @param self the `Tab` instance\n */\nconst triggerTabEnd = (self: Tab) => {\n  const { tabContent, nav } = self;\n\n  /* istanbul ignore else */\n  if (tabContent && hasClass(tabContent, collapsingClass)) {\n    tabContent.style.height = '';\n    removeClass(tabContent, collapsingClass);\n  }\n\n  /* istanbul ignore else */\n  if (nav) Timer.clear(nav);\n};\n\n/**\n * Executes before showing the tab content.\n *\n * @param self the `Tab` instance\n */\nconst triggerTabShow = (self: Tab) => {\n  const { element, tabContent, content: nextContent, nav } = self;\n  const { tab } = (isHTMLElement(nav) && tabPrivate.get(nav)) || { tab: null };\n\n  /* istanbul ignore else */\n  if (tabContent && nextContent && hasClass(nextContent, fadeClass)) {\n    const { currentHeight, nextHeight } = tabPrivate.get(element) || { currentHeight: 0, nextHeight: 0 };\n    if (currentHeight === nextHeight) {\n      triggerTabEnd(self);\n    } else {\n      // enables height animation\n      setTimeout(() => {\n        tabContent.style.height = `${nextHeight}px`;\n        reflow(tabContent);\n        emulateTransitionEnd(tabContent, () => triggerTabEnd(self));\n      }, 50);\n    }\n  } else if (nav) Timer.clear(nav);\n\n  shownTabEvent.relatedTarget = tab as HTMLElement | undefined;\n\n  dispatchEvent(element, shownTabEvent);\n};\n\n/**\n * Executes before hiding the tab.\n *\n * @param self the `Tab` instance\n */\nconst triggerTabHide = (self: Tab) => {\n  const { element, content: nextContent, tabContent, nav } = self;\n  const { tab, content } = (nav && tabPrivate.get(nav)) || { tab: null, content: null };\n  let currentHeight = 0;\n\n  /* istanbul ignore else */\n  if (tabContent && nextContent && hasClass(nextContent, fadeClass)) {\n    [content, nextContent].forEach(c => {\n      if (isHTMLElement(c)) addClass(c, 'overflow-hidden');\n    });\n    currentHeight = isHTMLElement(content) ? content.scrollHeight : /* istanbul ignore next */ 0;\n  }\n\n  // update relatedTarget and dispatch event\n  showTabEvent.relatedTarget = tab as HTMLElement | undefined;\n  hiddenTabEvent.relatedTarget = element;\n  dispatchEvent(element, showTabEvent);\n  if (showTabEvent.defaultPrevented) return;\n\n  if (nextContent) addClass(nextContent, activeClass);\n  if (content) removeClass(content, activeClass);\n\n  /* istanbul ignore else */\n  if (tabContent && nextContent && hasClass(nextContent, fadeClass)) {\n    const nextHeight = nextContent.scrollHeight;\n    tabPrivate.set(element, { currentHeight, nextHeight, tab: null, content: null });\n\n    addClass(tabContent, collapsingClass);\n    tabContent.style.height = `${currentHeight}px`;\n    reflow(tabContent);\n    [content, nextContent].forEach(c => {\n      if (c) removeClass(c, 'overflow-hidden');\n    });\n  }\n\n  if (nextContent && nextContent && hasClass(nextContent, fadeClass)) {\n    setTimeout(() => {\n      addClass(nextContent, showClass);\n      emulateTransitionEnd(nextContent, () => {\n        triggerTabShow(self);\n      });\n    }, 1);\n  } else {\n    if (nextContent) addClass(nextContent, showClass);\n    triggerTabShow(self);\n  }\n\n  if (tab) dispatchEvent(tab, hiddenTabEvent);\n};\n\n/**\n * Returns the current active tab and its target content.\n *\n * @param self the `Tab` instance\n * @returns the query result\n */\nconst getActiveTab = (self: Tab): { tab: HTMLElement | null; content: HTMLElement | null } => {\n  const { nav } = self;\n  if (!isHTMLElement(nav as HTMLElement | undefined)) return { tab: null, content: null };\n\n  const activeTabs = getElementsByClassName(activeClass, nav as HTMLElement);\n  let tab: HTMLElement | null = null;\n  /* istanbul ignore else */\n  if (activeTabs.length === 1 && !dropdownClasses.some(c => hasClass(activeTabs[0].parentElement as HTMLElement, c))) {\n    [tab] = activeTabs;\n  } else if (activeTabs.length > 1) {\n    tab = activeTabs[activeTabs.length - 1];\n  }\n  const content = isHTMLElement(tab as HTMLElement) ? getTargetElement(tab as HTMLElement) : null;\n  return { tab, content };\n};\n\n/**\n * Returns a parent dropdown.\n *\n * @param element the `Tab` element\n * @returns the parent dropdown\n */\nconst getParentDropdown = (element?: HTMLElement): HTMLElement | null => {\n  if (!isHTMLElement(element)) return null;\n  const dropdown = closest(element, `.${dropdownClasses.join(',.')}`);\n  return dropdown ? querySelector(`.${dropdownClasses[0]}-toggle`, dropdown) : null;\n};\n\n/**\n * Toggles on/off the `click` event listener.\n *\n * @param self the `Tab` instance\n * @param add when `true`, event listener is added\n */\nconst toggleTabHandler = (self: Tab, add?: boolean) => {\n  const action = add ? addListener : removeListener;\n  action(self.element, mouseclickEvent, tabClickHandler);\n};\n\n// TAB EVENT HANDLER\n// =================\n/**\n * Handles the `click` event listener.\n *\n * @param e the `Event` object\n */\nconst tabClickHandler = (e: Event) => {\n  const self = getTabInstance(e.target as HTMLElement);\n  /* istanbul ignore next: must filter */\n  if (!self) return;\n  e.preventDefault();\n\n  self.show();\n};\n\n// TAB DEFINITION\n// ==============\n/** Creates a new `Tab` instance. */\nexport default class Tab extends BaseComponent {\n  static selector = tabSelector;\n  static init = tabInitCallback;\n  static getInstance = getTabInstance;\n  declare nav: HTMLElement | null;\n  declare content: HTMLElement | null;\n  declare tabContent: HTMLElement | null;\n  declare nextContent: HTMLElement | null;\n  declare dropdown: HTMLElement | null;\n\n  /** @param target the target element */\n  constructor(target: HTMLElement | string) {\n    super(target);\n\n    // initialization element\n    const { element } = this;\n    const content = getTargetElement(element);\n\n    // no point initializing a tab without a corresponding content\n    if (!content) return;\n\n    const nav = closest(element, '.nav');\n    const container = closest(content, '.tab-content');\n\n    this.nav = nav;\n    this.content = content;\n    this.tabContent = container;\n\n    // event targets\n    this.dropdown = getParentDropdown(element);\n\n    // show first Tab instance of none is shown\n    // suggested on #432\n    const { tab } = getActiveTab(this);\n    if (nav && !tab) {\n      const firstTab = querySelector(tabSelector, nav);\n      const firstTabContent = firstTab && getTargetElement(firstTab);\n\n      /* istanbul ignore else */\n      if (firstTabContent) {\n        addClass(firstTab, activeClass);\n        addClass(firstTabContent, showClass);\n        addClass(firstTabContent, activeClass);\n        setAttribute(element, ariaSelected, 'true');\n      }\n    }\n\n    // add event listener\n    toggleTabHandler(this, true);\n  }\n\n  /**\n   * Returns component name string.\n   */\n  get name() {\n    return tabComponent;\n  }\n\n  // TAB PUBLIC METHODS\n  // ==================\n  /** Shows the tab to the user. */\n  show() {\n    const { element, content: nextContent, nav, dropdown } = this;\n\n    /* istanbul ignore else */\n    if (!(nav && Timer.get(nav)) && !hasClass(element, activeClass)) {\n      const { tab, content } = getActiveTab(this);\n\n      /* istanbul ignore else */\n      if (nav) tabPrivate.set(nav, { tab, content, currentHeight: 0, nextHeight: 0 });\n\n      // update relatedTarget and dispatch\n      hideTabEvent.relatedTarget = element;\n\n      if (isHTMLElement(tab as Node)) dispatchEvent(tab as EventTarget, hideTabEvent);\n      if (hideTabEvent.defaultPrevented) return;\n\n      addClass(element, activeClass);\n      setAttribute(element, ariaSelected, 'true');\n\n      const activeDropdown = isHTMLElement(tab as HTMLElement) && getParentDropdown(tab as HTMLElement);\n      if (activeDropdown && hasClass(activeDropdown, activeClass)) {\n        removeClass(activeDropdown, activeClass);\n      }\n\n      /* istanbul ignore else */\n      if (nav) {\n        const toggleTab = () => {\n          if (tab) {\n            removeClass(tab, activeClass);\n            setAttribute(tab, ariaSelected, 'false');\n          }\n          if (dropdown && !hasClass(dropdown, activeClass)) addClass(dropdown, activeClass);\n        };\n\n        if (content && (hasClass(content, fadeClass) || (nextContent && hasClass(nextContent, fadeClass)))) {\n          Timer.set(nav, toggleTab, 1);\n        } else toggleTab();\n      }\n\n      if (content) {\n        removeClass(content, showClass);\n        if (hasClass(content, fadeClass)) {\n          emulateTransitionEnd(content, () => triggerTabHide(this));\n        } else {\n          triggerTabHide(this);\n        }\n      }\n    }\n  }\n\n  /** Removes the `Tab` component from the target element. */\n  dispose() {\n    toggleTabHandler(this);\n    super.dispose();\n  }\n}\n"],"names":["tabString","tabComponent","tabSelector","dataBsToggle","getTabInstance","element","getInstance","tabInitCallback","Tab","showTabEvent","createCustomEvent","shownTabEvent","hideTabEvent","hiddenTabEvent","tabPrivate","triggerTabEnd","self","tabContent","nav","hasClass","collapsingClass","removeClass","Timer","triggerTabShow","nextContent","tab","isHTMLElement","fadeClass","currentHeight","nextHeight","reflow","emulateTransitionEnd","dispatchEvent","triggerTabHide","content","c","addClass","activeClass","showClass","getActiveTab","activeTabs","getElementsByClassName","dropdownClasses","getTargetElement","getParentDropdown","dropdown","closest","querySelector","toggleTabHandler","add","addListener","removeListener","mouseclickEvent","tabClickHandler","e","BaseComponent","target","container","firstTab","firstTabContent","setAttribute","ariaSelected","activeDropdown","toggleTab"],"mappings":"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"}