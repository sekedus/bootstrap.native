{"version":3,"file":"collapse.cjs","sources":["../../src/strings/collapseString.ts","../../src/strings/collapseComponent.ts","../../src/components/collapse.ts"],"sourcesContent":["/** @type {string} */\nconst collapseString = 'collapse';\nexport default collapseString;\n","/** @type {string} */\nconst collapseComponent = 'Collapse';\nexport default collapseComponent;\n","/* Native JavaScript for Bootstrap 5 | Collapse\n----------------------------------------------- */\nimport {\n  getInstance,\n  setAttribute,\n  getDocument,\n  closest,\n  querySelector,\n  querySelectorAll,\n  addClass,\n  hasClass,\n  removeClass,\n  mouseclickEvent,\n  ariaExpanded,\n  emulateTransitionEnd,\n  reflow,\n  dispatchEvent,\n  setElementStyle,\n  Timer,\n  createCustomEvent,\n  noop,\n  isHTMLElement,\n  isString,\n} from '@thednp/shorty';\n\nimport { addListener, removeListener } from '@thednp/event-listener';\n\nimport dataBsToggle from '../strings/dataBsToggle';\nimport collapsingClass from '../strings/collapsingClass';\nimport showClass from '../strings/showClass';\nimport collapseString from '../strings/collapseString';\nimport collapseComponent from '../strings/collapseComponent';\n\nimport getTargetElement from '../util/getTargetElement';\nimport BaseComponent from './base-component';\nimport type { CollapseEvent, CollapseOptions } from '../interface/collapse';\n\n// COLLAPSE GC\n// ===========\nconst collapseSelector = `.${collapseString}`;\nconst collapseToggleSelector = `[${dataBsToggle}=\"${collapseString}\"]`;\nconst collapseDefaults = { parent: null };\n\n/**\n * Static method which returns an existing `Collapse` instance associated\n * to a target `Element`.\n */\nconst getCollapseInstance = (element: HTMLElement) => getInstance<Collapse>(element, collapseComponent);\n\n/**\n * A `Collapse` initialization callback.\n */\nconst collapseInitCallback = (element: HTMLElement) => new Collapse(element);\n\n// COLLAPSE CUSTOM EVENTS\n// ======================\nconst showCollapseEvent = createCustomEvent<CollapseEvent>(`show.bs.${collapseString}`);\nconst shownCollapseEvent = createCustomEvent<CollapseEvent>(`shown.bs.${collapseString}`);\nconst hideCollapseEvent = createCustomEvent<CollapseEvent>(`hide.bs.${collapseString}`);\nconst hiddenCollapseEvent = createCustomEvent<CollapseEvent>(`hidden.bs.${collapseString}`);\n\n// COLLAPSE PRIVATE METHODS\n// ========================\n/**\n * Expand the designated `Element`.\n *\n * @param self the `Collapse` instance\n */\nconst expandCollapse = (self: Collapse) => {\n  const { element, parent, triggers } = self;\n\n  dispatchEvent(element, showCollapseEvent);\n  if (!showCollapseEvent.defaultPrevented) {\n    Timer.set(element, noop, 17);\n    if (parent) Timer.set(parent, noop, 17);\n\n    addClass(element, collapsingClass);\n    removeClass(element, collapseString);\n\n    setElementStyle(element, { height: `${element.scrollHeight}px` });\n\n    emulateTransitionEnd(element, () => {\n      Timer.clear(element);\n      if (parent) Timer.clear(parent);\n\n      triggers.forEach(btn => setAttribute(btn, ariaExpanded, 'true'));\n\n      removeClass(element, collapsingClass);\n      addClass(element, collapseString);\n      addClass(element, showClass);\n\n      setElementStyle(element, { height: '' });\n\n      dispatchEvent(element, shownCollapseEvent);\n    });\n  }\n};\n\n/**\n * Collapse the designated `Element`.\n *\n * @param self the `Collapse` instance\n */\nconst collapseContent = (self: Collapse) => {\n  const { element, parent, triggers } = self;\n\n  dispatchEvent(element, hideCollapseEvent);\n\n  if (!hideCollapseEvent.defaultPrevented) {\n    Timer.set(element, noop, 17);\n    if (parent) Timer.set(parent, noop, 17);\n\n    setElementStyle(element, { height: `${element.scrollHeight}px` });\n\n    removeClass(element, collapseString);\n    removeClass(element, showClass);\n    addClass(element, collapsingClass);\n\n    reflow(element);\n    setElementStyle(element, { height: '0px' });\n\n    emulateTransitionEnd(element, () => {\n      Timer.clear(element);\n      /* istanbul ignore else */\n      if (parent) Timer.clear(parent);\n\n      triggers.forEach(btn => setAttribute(btn, ariaExpanded, 'false'));\n\n      removeClass(element, collapsingClass);\n      addClass(element, collapseString);\n\n      setElementStyle(element, { height: '' });\n\n      dispatchEvent(element, hiddenCollapseEvent);\n    });\n  }\n};\n\n// COLLAPSE EVENT HANDLER\n// ======================\n/**\n * Handles the `click` event for the `Collapse` instance.\n *\n * @param e the `Event` object\n */\nconst collapseClickHandler = (e: MouseEvent) => {\n  const { target } = e; // our target is `HTMLElement`\n  const trigger = target && closest(target as HTMLElement, collapseToggleSelector);\n  const element = trigger && getTargetElement(trigger);\n  const self = element && getCollapseInstance(element);\n  /* istanbul ignore else */\n  if (self) self.toggle();\n\n  // event target is anchor link #398\n  if (trigger && trigger.tagName === 'A') e.preventDefault();\n};\n\n// COLLAPSE DEFINITION\n// ===================\n\n/** Returns a new `Colapse` instance. */\nexport default class Collapse extends BaseComponent {\n  static selector = collapseSelector;\n  static init = collapseInitCallback;\n  static getInstance = getCollapseInstance;\n  declare options: CollapseOptions;\n  declare parent: HTMLElement | null;\n  declare triggers: HTMLElement[];\n\n  /**\n   * @param target and `Element` that matches the selector\n   * @param config instance options\n   */\n  constructor(target: HTMLElement | string, config?: Partial<CollapseOptions>) {\n    super(target, config);\n\n    // initialization element\n    const { element, options } = this;\n    const doc = getDocument(element);\n\n    // set triggering elements\n    this.triggers = [...querySelectorAll(collapseToggleSelector, doc)].filter(btn => getTargetElement(btn) === element);\n\n    // set parent accordion\n    this.parent = isHTMLElement(options.parent)\n      ? options.parent\n      : isString(options.parent)\n      ? getTargetElement(element) || querySelector(options.parent as string, doc)\n      : null;\n\n    // add event listeners\n    this._toggleEventListeners(true);\n  }\n\n  /**\n   * Returns component name string.\n   */\n  get name() {\n    return collapseComponent;\n  }\n  /**\n   * Returns component default options.\n   */\n  get defaults() {\n    return collapseDefaults;\n  }\n\n  // COLLAPSE PUBLIC METHODS\n  // =======================\n  /** Hides the collapse. */\n  hide() {\n    const { triggers, element } = this;\n    if (!Timer.get(element)) {\n      collapseContent(this);\n      /* istanbul ignore else */\n      if (triggers.length) {\n        triggers.forEach(btn => addClass(btn, `${collapseString}d`));\n      }\n    }\n  }\n\n  /** Shows the collapse. */\n  show() {\n    const { element, parent, triggers } = this;\n    let activeCollapse;\n    let activeCollapseInstance;\n\n    if (parent) {\n      activeCollapse = [...querySelectorAll(`.${collapseString}.${showClass}`, parent)].find(i =>\n        getCollapseInstance(i),\n      );\n      activeCollapseInstance = activeCollapse && getCollapseInstance(activeCollapse);\n    }\n\n    if ((!parent || !Timer.get(parent)) && !Timer.get(element)) {\n      if (activeCollapseInstance && activeCollapse !== element) {\n        collapseContent(activeCollapseInstance);\n        activeCollapseInstance.triggers.forEach(btn => {\n          addClass(btn, `${collapseString}d`);\n        });\n      }\n\n      expandCollapse(this);\n      /* istanbul ignore else */\n      if (triggers.length) {\n        triggers.forEach(btn => removeClass(btn, `${collapseString}d`));\n      }\n    }\n  }\n\n  /** Toggles the visibility of the collapse. */\n  toggle() {\n    if (!hasClass(this.element, showClass)) this.show();\n    else this.hide();\n  }\n\n  /**\n   * Toggles on/off the event listener(s) of the `Collapse` instance.\n   *\n   * @param add when `true`, the event listener is added\n   */\n  _toggleEventListeners = (add?: boolean) => {\n    const action = add ? addListener : removeListener;\n    const { triggers } = this;\n\n    /* istanbul ignore else */\n    if (triggers.length) {\n      triggers.forEach(btn => action(btn, mouseclickEvent, collapseClickHandler));\n    }\n  };\n\n  /** Remove the `Collapse` component from the target `Element`. */\n  dispose() {\n    this._toggleEventListeners();\n\n    super.dispose();\n  }\n}\n"],"names":["collapseString","collapseComponent","collapseSelector","collapseToggleSelector","dataBsToggle","collapseDefaults","getCollapseInstance","element","getInstance","collapseInitCallback","Collapse","showCollapseEvent","createCustomEvent","shownCollapseEvent","hideCollapseEvent","hiddenCollapseEvent","expandCollapse","self","parent","triggers","dispatchEvent","Timer","noop","addClass","collapsingClass","removeClass","setElementStyle","emulateTransitionEnd","btn","setAttribute","ariaExpanded","showClass","collapseContent","reflow","collapseClickHandler","e","target","trigger","closest","getTargetElement","BaseComponent","config","__publicField","add","action","addListener","removeListener","mouseclickEvent","options","doc","getDocument","querySelectorAll","isHTMLElement","isString","querySelector","activeCollapse","activeCollapseInstance","i","hasClass"],"mappings":"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"}