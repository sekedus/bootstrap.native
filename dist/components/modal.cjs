"use strict";var B=Object.defineProperty;var I=(o,s,t)=>s in o?B(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var u=(o,s,t)=>(I(o,typeof s!="symbol"?s+"":s,t),t);const e=require("@thednp/shorty"),C=require("@thednp/event-listener"),F=require("./dataBsToggle-c8bc9e7f.js"),x=require("./dataBsDismiss-4ee313a7.js"),P=require("./fadeClass-a4944cf1.js"),g=require("./showClass-2174a6d6.js"),r=require("./popupContainer-edee469f.js"),l=require("./isVisible-12a76845.js"),q=require("./getTargetElement-93cf2bb8.js"),R=require("./base-component-f3cef043.js"),_=`.${r.modalString}`,$=`[${F.dataBsToggle}="${r.modalString}"]`,V=`[${x.dataBsDismiss}="${r.modalString}"]`,M=`${r.modalString}-static`,W={backdrop:!0,keyboard:!0},v=o=>e.getInstance(o,l.modalComponent),z=o=>new p(o),f=e.createCustomEvent(`show.bs.${r.modalString}`),y=e.createCustomEvent(`shown.bs.${r.modalString}`),E=e.createCustomEvent(`hide.bs.${r.modalString}`),b=e.createCustomEvent(`hidden.bs.${r.modalString}`),O=o=>{const{element:s}=o,t=l.measureScrollbar(s),{clientHeight:a,scrollHeight:n}=e.getDocumentElement(s),{clientHeight:i,scrollHeight:m}=s,h=i!==m;if(!h&&t){const c=e.isRTL(s)?"paddingLeft":"paddingRight",d={};d[c]=`${t}px`,e.setElementStyle(s,d)}l.setScrollbar(s,h||a!==n)},L=(o,s)=>{const t=s?C.addListener:C.removeListener,{element:a,update:n}=o;t(a,e.mouseclickEvent,j),t(e.getWindow(a),e.resizeEvent,n,e.passiveHandler),t(e.getDocument(a),e.keydownEvent,N)},w=o=>{const{triggers:s,element:t,relatedTarget:a}=o;l.removeOverlay(t),e.setElementStyle(t,{paddingRight:"",display:""}),L(o);const n=f.relatedTarget||s.find(l.isVisible);n&&e.focus(n),b.relatedTarget=a,e.dispatchEvent(t,b)},D=o=>{const{element:s,relatedTarget:t}=o;e.focus(s),L(o,!0),y.relatedTarget=t,e.dispatchEvent(s,y)},k=o=>{const{element:s,hasFade:t}=o;e.setElementStyle(s,{display:"block"}),O(o),l.getCurrentOpen(s)||e.setElementStyle(e.getDocumentBody(s),{overflow:"hidden"}),e.addClass(s,g.showClass),e.removeAttribute(s,e.ariaHidden),e.setAttribute(s,e.ariaModal,"true"),t?e.emulateTransitionEnd(s,()=>D(o)):D(o)},H=o=>{const{element:s,options:t,hasFade:a}=o;t.backdrop&&a&&e.hasClass(l.overlay,g.showClass)&&!l.getCurrentOpen(s)?(l.hideOverlay(),e.emulateTransitionEnd(l.overlay,()=>w(o))):w(o)},K=o=>{const{target:s}=o,t=s&&e.closest(s,$),a=t&&q.getTargetElement(t),n=a&&v(a);n&&(t&&t.tagName==="A"&&o.preventDefault(),n.relatedTarget=t,n.toggle())},N=({code:o,target:s})=>{const t=e.querySelector(l.modalActiveSelector,e.getDocument(s)),a=t&&v(t);if(a){const{options:n}=a;n.keyboard&&o===e.keyEscape&&e.hasClass(t,g.showClass)&&(a.relatedTarget=null,a.hide())}},j=o=>{var a,n;const{currentTarget:s}=o,t=s?v(s):null;if(t&&s&&!e.Timer.get(s)){const{options:i,isStatic:m,modalDialog:h}=t,{backdrop:c}=i,{target:d}=o,A=(n=(a=e.getDocument(s))==null?void 0:a.getSelection())==null?void 0:n.toString().length,T=h.contains(d),S=d&&e.closest(d,V);m&&!T?e.Timer.set(s,()=>{e.addClass(s,M),e.emulateTransitionEnd(h,()=>G(t))},17):(S||!A&&!m&&!T&&c)&&(t.relatedTarget=S||null,t.hide(),o.preventDefault())}},G=o=>{const{element:s,modalDialog:t}=o,a=(e.getElementTransitionDuration(t)||0)+17;e.removeClass(s,M),e.Timer.set(s,()=>e.Timer.clear(s),a)};class p extends R.BaseComponent{constructor(t,a){super(t,a);u(this,"update",()=>{e.hasClass(this.element,g.showClass)&&O(this)});u(this,"_toggleEventListeners",t=>{const a=t?C.addListener:C.removeListener,{triggers:n}=this;n.length&&n.forEach(i=>a(i,e.mouseclickEvent,K))});const{element:n}=this,i=e.querySelector(`.${r.modalString}-dialog`,n);i&&(this.modalDialog=i,this.triggers=[...e.querySelectorAll($,e.getDocument(n))].filter(m=>q.getTargetElement(m)===n),this.isStatic=this.options.backdrop==="static",this.hasFade=e.hasClass(n,P.fadeClass),this.relatedTarget=null,this._toggleEventListeners(!0))}get name(){return l.modalComponent}get defaults(){return W}toggle(){e.hasClass(this.element,g.showClass)?this.hide():this.show()}show(){const{element:t,options:a,hasFade:n,relatedTarget:i}=this,{backdrop:m}=a;let h=0;if(!e.hasClass(t,g.showClass)&&(f.relatedTarget=i||void 0,e.dispatchEvent(t,f),!f.defaultPrevented)){const c=l.getCurrentOpen(t);if(c&&c!==t){const d=v(c)||e.getInstance(c,l.offcanvasComponent);d&&d.hide()}m?(r.hasPopup(l.overlay)?l.toggleOverlayType(!0):l.appendOverlay(t,n,!0),h=e.getElementTransitionDuration(l.overlay),l.showOverlay(),setTimeout(()=>k(this),h)):(k(this),c&&e.hasClass(l.overlay,g.showClass)&&l.hideOverlay())}}hide(){const{element:t,hasFade:a,relatedTarget:n}=this;e.hasClass(t,g.showClass)&&(E.relatedTarget=n||void 0,e.dispatchEvent(t,E),E.defaultPrevented||(e.removeClass(t,g.showClass),e.setAttribute(t,e.ariaHidden,"true"),e.removeAttribute(t,e.ariaModal),a?e.emulateTransitionEnd(t,()=>H(this)):H(this)))}dispose(){const t={...this},{element:a,modalDialog:n}=t,i=()=>super.dispose();this._toggleEventListeners(),this.hide(),e.hasClass(a,"fade")?e.emulateTransitionEnd(n,i):i()}}u(p,"selector",_),u(p,"init",z),u(p,"getInstance",v);module.exports=p;
//# sourceMappingURL=modal.cjs.map
