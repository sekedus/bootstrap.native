"use strict";var A=Object.defineProperty;var B=(o,s,t)=>s in o?A(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var u=(o,s,t)=>B(o,typeof s!="symbol"?s+"":s,t);const e=require("@thednp/shorty"),C=require("@thednp/event-listener"),I=require("./dataBsToggle-Dj-Ng54N.js"),_=require("./dataBsDismiss-CMHF7If_.js"),x=require("./fadeClass-Co6nOzNJ.js"),c=require("./showClass-D_Ms1FgG.js"),r=require("./popupContainer-DIlSFkzD.js"),i=require("./isVisible-B0Eb0LaK.js"),H=require("./getTargetElement-Cl-PhUJH.js"),R=require("./base-component-DBcDoOjV.js"),P=`.${r.modalString}`,O=`[${I.dataBsToggle}="${r.modalString}"]`,V=`[${_.dataBsDismiss}="${r.modalString}"]`,$=`${r.modalString}-static`,z={backdrop:!0,keyboard:!0},p=o=>e.getInstance(o,i.modalComponent),K=o=>new v(o),f=e.createCustomEvent(`show.bs.${r.modalString}`),S=e.createCustomEvent(`shown.bs.${r.modalString}`),T=e.createCustomEvent(`hide.bs.${r.modalString}`),y=e.createCustomEvent(`hidden.bs.${r.modalString}`),M=o=>{const{element:s}=o,t=i.measureScrollbar(s),{clientHeight:a,scrollHeight:n}=e.getDocumentElement(s),{clientHeight:l,scrollHeight:d}=s,g=l!==d;// istanbul ignore next @preserve: impossible to test?
if(!g&&t){const h={[e.isRTL(s)?"paddingLeft":"paddingRight"]:`${t}px`};e.setElementStyle(s,h)}i.setScrollbar(s,g||a!==n)},L=(o,s)=>{const t=s?C.addListener:C.removeListener,{element:a}=o;t(a,e.mouseclickEvent,j),t(e.getDocument(a),e.keydownEvent,W),s?o._observer.observe(a):o._observer.disconnect()},w=o=>{const{triggers:s,element:t,relatedTarget:a}=o;i.removeOverlay(t),e.setElementStyle(t,{paddingRight:"",display:""}),L(o);const n=f.relatedTarget||s.find(i.isVisible);// istanbul ignore else @preserve
n&&e.focus(n),y.relatedTarget=a,e.dispatchEvent(t,y),e.toggleFocusTrap(t)},D=o=>{const{element:s,relatedTarget:t}=o;e.focus(s),L(o,!0),S.relatedTarget=t,e.dispatchEvent(s,S),e.toggleFocusTrap(s)},k=o=>{const{element:s,hasFade:t}=o;e.setElementStyle(s,{display:"block"}),M(o);// istanbul ignore else @preserve
i.getCurrentOpen(s)||e.setElementStyle(e.getDocumentBody(s),{overflow:"hidden"}),e.addClass(s,c.showClass),e.removeAttribute(s,e.ariaHidden),e.setAttribute(s,e.ariaModal,"true"),t?e.emulateTransitionEnd(s,()=>D(o)):D(o)},q=o=>{const{element:s,options:t,hasFade:a}=o;t.backdrop&&a&&e.hasClass(i.overlay,c.showClass)&&!i.getCurrentOpen(s)?(i.hideOverlay(),e.emulateTransitionEnd(i.overlay,()=>w(o))):w(o)},N=o=>{const{target:s}=o,t=s&&e.closest(s,O),a=t&&H.getTargetElement(t),n=a&&p(a);// istanbul ignore else @preserve
if(n){// istanbul ignore else @preserve
t&&t.tagName==="A"&&o.preventDefault(),n.relatedTarget=t,n.toggle()}},W=({code:o,target:s})=>{const t=e.querySelector(i.modalActiveSelector,e.getDocument(s)),a=t&&p(t);// istanbul ignore else @preserve
if(a){const{options:n}=a;// istanbul ignore else @preserve
n.keyboard&&o===e.keyEscape&&e.hasClass(t,c.showClass)&&(a.relatedTarget=null,a.hide())}},j=o=>{var a,n;const{currentTarget:s}=o,t=s&&p(s);// istanbul ignore else @preserve
if(t&&s&&!e.Timer.get(s)){const{options:l,isStatic:d,modalDialog:g}=t,{backdrop:m}=l,{target:h}=o,F=(n=(a=e.getDocument(s))==null?void 0:a.getSelection())==null?void 0:n.toString().length,E=g.contains(h),b=h&&e.closest(h,V);// istanbul ignore else @preserve
d&&!E?e.Timer.set(s,()=>{e.addClass(s,$),e.emulateTransitionEnd(g,()=>G(t))},17):(b||!F&&!d&&!E&&m)&&(t.relatedTarget=b||null,t.hide(),o.preventDefault())}},G=o=>{const{element:s,modalDialog:t}=o,a=(e.getElementTransitionDuration(t)||0)+17;e.removeClass(s,$),e.Timer.set(s,()=>e.Timer.clear(s),a)};class v extends R.BaseComponent{constructor(t,a){super(t,a);u(this,"update",()=>{// istanbul ignore else @preserve
e.hasClass(this.element,c.showClass)&&M(this)});u(this,"_toggleEventListeners",t=>{const a=t?C.addListener:C.removeListener,{triggers:n}=this;// istanbul ignore else @preserve
n.length&&n.forEach(l=>a(l,e.mouseclickEvent,N))});const{element:n}=this,l=e.querySelector(`.${r.modalString}-dialog`,n);// istanbul ignore else @preserve
l&&(this.modalDialog=l,this.triggers=[...e.querySelectorAll(O,e.getDocument(n))].filter(d=>H.getTargetElement(d)===n),this.isStatic=this.options.backdrop==="static",this.hasFade=e.hasClass(n,x.fadeClass),this.relatedTarget=null,this._observer=new ResizeObserver(()=>this.update()),this._toggleEventListeners(!0))}get name(){return i.modalComponent}get defaults(){return z}toggle(){e.hasClass(this.element,c.showClass)?this.hide():this.show()}show(){const{element:t,options:a,hasFade:n,relatedTarget:l}=this,{backdrop:d}=a;let g=0;// istanbul ignore else @preserve
if(!e.hasClass(t,c.showClass)&&(f.relatedTarget=l||void 0,e.dispatchEvent(t,f),!f.defaultPrevented)){const m=i.getCurrentOpen(t);// istanbul ignore else @preserve
if(m&&m!==t){const h=p(m)||e.getInstance(m,i.offcanvasComponent);// istanbul ignore else @preserve
h&&h.hide()}if(d)r.hasPopup(i.overlay)?i.toggleOverlayType(!0):i.appendOverlay(t,n,!0),g=e.getElementTransitionDuration(i.overlay),i.showOverlay(),setTimeout(()=>k(this),g);else{k(this);// istanbul ignore else @preserve
m&&e.hasClass(i.overlay,c.showClass)&&i.hideOverlay()}}}hide(){const{element:t,hasFade:a,relatedTarget:n}=this;// istanbul ignore else @preserve
if(e.hasClass(t,c.showClass)){T.relatedTarget=n||void 0,e.dispatchEvent(t,T);// istanbul ignore else @preserve
T.defaultPrevented||(e.removeClass(t,c.showClass),e.setAttribute(t,e.ariaHidden,"true"),e.removeAttribute(t,e.ariaModal),a?e.emulateTransitionEnd(t,()=>q(this)):q(this))}}dispose(){const t={...this},{modalDialog:a,hasFade:n}=t,l=()=>setTimeout(()=>super.dispose(),17);this.hide(),this._toggleEventListeners(),n?e.emulateTransitionEnd(a,l):l()}}u(v,"selector",P),u(v,"init",K),u(v,"getInstance",p);module.exports=v;
//# sourceMappingURL=modal.cjs.map
