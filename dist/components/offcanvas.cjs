"use strict";var q=Object.defineProperty;var k=(n,t,s)=>t in n?q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var v=(n,t,s)=>k(n,typeof t!="symbol"?t+"":t,s);const e=require("@thednp/shorty"),h=require("@thednp/event-listener"),A=require("./dataBsDismiss-CMHF7If_.js"),$=require("./dataBsToggle-Dj-Ng54N.js"),c=require("./showClass-D_Ms1FgG.js"),i=require("./popupContainer-DIlSFkzD.js"),a=require("./isVisible-B0Eb0LaK.js"),S=require("./getTargetElement-Cl-PhUJH.js"),H=require("./base-component-DBcDoOjV.js"),L=`.${i.offcanvasString}`,b=`[${$.dataBsToggle}="${i.offcanvasString}"]`,B=`[${A.dataBsDismiss}="${i.offcanvasString}"]`,p=`${i.offcanvasString}-toggling`,I={backdrop:!0,keyboard:!0,scroll:!1},u=n=>e.getInstance(n,a.offcanvasComponent),P=n=>new d(n),m=e.createCustomEvent(`show.bs.${i.offcanvasString}`),w=e.createCustomEvent(`shown.bs.${i.offcanvasString}`),E=e.createCustomEvent(`hide.bs.${i.offcanvasString}`),O=e.createCustomEvent(`hidden.bs.${i.offcanvasString}`),_=n=>{const{element:t}=n,{clientHeight:s,scrollHeight:o}=e.getDocumentElement(t);a.setScrollbar(t,s!==o)},D=(n,t)=>{const s=t?h.addListener:h.removeListener,o=e.getDocument(n.element);s(o,e.keydownEvent,N),s(o,e.mouseclickEvent,M)},T=n=>{const{element:t,options:s}=n;// istanbul ignore else @preserve
s.scroll||(_(n),e.setElementStyle(e.getDocumentBody(t),{overflow:"hidden"})),e.addClass(t,p),e.addClass(t,c.showClass),e.setElementStyle(t,{visibility:"visible"}),e.emulateTransitionEnd(t,()=>V(n))},x=n=>{const{element:t,options:s}=n,o=a.getCurrentOpen(t);t.blur(),!o&&s.backdrop&&e.hasClass(a.overlay,c.showClass)&&a.hideOverlay(),e.emulateTransitionEnd(t,()=>K(n))},F=n=>{const t=e.closest(n.target,b),s=t&&S.getTargetElement(t),o=s&&u(s);// istanbul ignore else @preserve
if(o){o.relatedTarget=t,o.toggle();// istanbul ignore else @preserve
t&&t.tagName==="A"&&n.preventDefault()}},M=n=>{const{target:t}=n,s=e.querySelector(a.offcanvasActiveSelector,e.getDocument(t)),o=e.querySelector(B,s),r=s&&u(s);// istanbul ignore else @preserve
if(r){const{options:f,triggers:l}=r,{backdrop:g}=f,C=e.closest(t,b),y=e.getDocument(s).getSelection();// istanbul ignore else: a filter is required here @preserve
if(!a.overlay.contains(t)||g!=="static"){// istanbul ignore else @preserve
!(y&&y.toString().length)&&(!s.contains(t)&&g&&(!C||l.includes(t))||o&&o.contains(t))&&(r.relatedTarget=o&&o.contains(t)?o:null,r.hide());// istanbul ignore next @preserve
C&&C.tagName==="A"&&n.preventDefault()}}},N=({code:n,target:t})=>{const s=e.querySelector(a.offcanvasActiveSelector,e.getDocument(t)),o=s&&u(s);// istanbul ignore else @preserve
if(o){// istanbul ignore else @preserve
o.options.keyboard&&n===e.keyEscape&&(o.relatedTarget=null,o.hide())}},V=n=>{const{element:t}=n;e.removeClass(t,p),e.removeAttribute(t,e.ariaHidden),e.setAttribute(t,e.ariaModal,"true"),e.setAttribute(t,"role","dialog"),e.dispatchEvent(t,w),D(n,!0),e.focus(t),e.toggleFocusTrap(t)},K=n=>{const{element:t,triggers:s}=n;e.setAttribute(t,e.ariaHidden,"true"),e.removeAttribute(t,e.ariaModal),e.removeAttribute(t,"role"),e.setElementStyle(t,{visibility:""});const o=m.relatedTarget||s.find(a.isVisible);// istanbul ignore else @preserve
o&&e.focus(o),a.removeOverlay(t),e.dispatchEvent(t,O),e.removeClass(t,p),e.toggleFocusTrap(t),a.getCurrentOpen(t)||D(n)};class d extends H.BaseComponent{constructor(s,o){super(s,o);v(this,"_toggleEventListeners",s=>{const o=s?h.addListener:h.removeListener;this.triggers.forEach(r=>o(r,e.mouseclickEvent,F))});const{element:r}=this;this.triggers=[...e.querySelectorAll(b,e.getDocument(r))].filter(f=>S.getTargetElement(f)===r),this.relatedTarget=null,this._toggleEventListeners(!0)}get name(){return a.offcanvasComponent}get defaults(){return I}toggle(){e.hasClass(this.element,c.showClass)?this.hide():this.show()}show(){const{element:s,options:o,relatedTarget:r}=this;let f=0;if(!e.hasClass(s,c.showClass)&&(m.relatedTarget=r||void 0,w.relatedTarget=r||void 0,e.dispatchEvent(s,m),!m.defaultPrevented)){const l=a.getCurrentOpen(s);if(l&&l!==s){const g=u(l)||e.getInstance(l,a.modalComponent);// istanbul ignore else @preserve
g&&g.hide()}if(o.backdrop)i.hasPopup(a.overlay)?a.toggleOverlayType():a.appendOverlay(s,!0),f=e.getElementTransitionDuration(a.overlay),a.showOverlay(),setTimeout(()=>T(this),f);else{T(this);// istanbul ignore next @preserve - this test was done on Modal
l&&e.hasClass(a.overlay,c.showClass)&&a.hideOverlay()}}}hide(){const{element:s,relatedTarget:o}=this;e.hasClass(s,c.showClass)&&(E.relatedTarget=o||void 0,O.relatedTarget=o||void 0,e.dispatchEvent(s,E),E.defaultPrevented||(e.addClass(s,p),e.removeClass(s,c.showClass),x(this)))}dispose(){const{element:s}=this,o=e.hasClass(s,c.showClass),r=()=>setTimeout(()=>super.dispose(),1);if(this.hide(),this._toggleEventListeners(),o){e.emulateTransitionEnd(s,r);// istanbul ignore next @preserve
}else r()}}v(d,"selector",L),v(d,"init",P),v(d,"getInstance",u);module.exports=d;
//# sourceMappingURL=offcanvas.cjs.map
