"use strict";var ot=Object.defineProperty;var rt=(s,n,e)=>n in s?ot(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var h=(s,n,e)=>rt(s,typeof n!="symbol"?n+"":n,e);const t=require("@thednp/shorty"),y=require("@thednp/event-listener"),m=require("./showClass-D_Ms1FgG.js"),G=require("./dataBsToggle-Dj-Ng54N.js"),A=require("./dropdownClasses-CnEyz_iw.js"),it=require("./base-component-DBcDoOjV.js"),J="Dropdown",Q="dropdown-menu",V=s=>{const n=t.closest(s,"A");return s.tagName==="A"&&t.hasAttribute(s,"href")&&t.getAttribute(s,"href").slice(-1)==="#"||n&&t.hasAttribute(n,"href")&&t.getAttribute(n,"href").slice(-1)==="#"},[p,H,I,M]=A.dropdownMenuClasses,X=`[${G.dataBsToggle}="${p}"]`,f=s=>t.getInstance(s,J),ct=s=>new g(s),dt=`${Q}-end`,j=[p,H],F=[I,M],U=["A","BUTTON"],at={offset:5,display:"dynamic"},T=t.createCustomEvent(`show.bs.${p}`),W=t.createCustomEvent(`shown.bs.${p}`),$=t.createCustomEvent(`hide.bs.${p}`),R=t.createCustomEvent(`hidden.bs.${p}`),Y=t.createCustomEvent(`updated.bs.${p}`),Z=s=>{const{element:n,menu:e,parentElement:i,options:c}=s,{offset:o}=c;// istanbul ignore else @preserve: this test requires a navbar
if(t.getElementStyle(e,"position")!=="static"){const r=t.isRTL(n),d=t.hasClass(e,dt);["margin","top","bottom","left","right"].forEach(l=>{const _={};_[l]="",t.setElementStyle(e,_)});let a=A.dropdownMenuClasses.find(l=>t.hasClass(i,l))||p;const tt={dropdown:[o,0,0],dropup:[0,0,o],dropstart:r?[-1,0,0,o]:[-1,o,0],dropend:r?[-1,o,0]:[-1,0,0,o]},E={dropdown:{top:"100%"},dropup:{top:"auto",bottom:"100%"},dropstart:r?{left:"100%",right:"auto"}:{left:"auto",right:"100%"},dropend:r?{left:"auto",right:"100%"}:{left:"100%",right:"auto"},menuStart:r?{right:"0",left:"auto"}:{right:"auto",left:"0"},menuEnd:r?{right:"auto",left:"0"}:{right:"0",left:"auto"}},{offsetWidth:w,offsetHeight:k}=e,{clientWidth:B,clientHeight:P}=t.getDocumentElement(n),{left:v,top:x,width:N,height:et}=t.getBoundingClientRect(n),L=v-w-o<0,S=v+w+N+o>=B,nt=x+k+o>=P,q=x+k+et+o>=P,O=x-k-o<0,C=(!r&&d||r&&!d)&&v+N-w<0,b=(r&&d||!r&&!d)&&v+w>=B;if(F.includes(a)&&L&&S&&(a=p),a===I&&(r?S:L)&&(a=M),a===M&&(r?L:S)&&(a=I),a===H&&O&&!q&&(a=p),a===p&&q&&!O&&(a=H),F.includes(a)&&nt&&t.ObjectAssign(E[a],{top:"auto",bottom:0}),j.includes(a)&&(C||b)){let l={left:"auto",right:"auto"};// istanbul ignore else @preserve
!C&&b&&!r&&(l={left:"auto",right:0});// istanbul ignore else @preserve
C&&!b&&r&&(l={left:0,right:"auto"});// istanbul ignore else @preserve
l&&t.ObjectAssign(E[a],l)}const st=tt[a];if(t.setElementStyle(e,{...E[a],margin:`${st.map(l=>l&&`${l}px`).join(" ")}`}),j.includes(a)&&d){// istanbul ignore else @preserve
if(d){const l=!r&&C||r&&b?"menuStart":"menuEnd";t.setElementStyle(e,E[l])}}t.dispatchEvent(i,Y)}},lt=s=>[...s.children].map(n=>{if(n&&U.includes(n.tagName))return n;const{firstElementChild:e}=n;return e&&U.includes(e.tagName)?e:null}).filter(n=>n),z=s=>{const{element:n,options:e,menu:i}=s,c=s.open?y.addListener:y.removeListener,o=t.getDocument(n);c(o,t.mouseclickEvent,K),c(o,t.focusEvent,K),c(o,t.keydownEvent,pt),c(o,t.keyupEvent,ft);// istanbul ignore else @preserve
e.display==="dynamic"&&(s.open?s._observer.observe(i):s._observer.disconnect())},D=s=>{const n=[...A.dropdownMenuClasses,"btn-group","input-group"].map(e=>t.getElementsByClassName(`${e} ${m.showClass}`,t.getDocument(s))).find(e=>e.length);if(n&&n.length)return[...n[0].children].find(e=>A.dropdownMenuClasses.some(i=>i===t.getAttribute(e,G.dataBsToggle)))},K=s=>{const{target:n,type:e}=s;// istanbul ignore else @preserve
if(n&&t.isHTMLElement(n)){const i=D(n),c=i&&f(i);// istanbul ignore else @preserve
if(c){const{parentElement:o,menu:r}=c,d=o&&o.contains(n)&&(n.tagName==="form"||t.closest(n,"form")!==null);[t.mouseclickEvent,t.mousedownEvent].includes(e)&&V(n)&&s.preventDefault();// istanbul ignore else @preserve
!d&&e!==t.focusEvent&&n!==i&&n!==r&&c.hide()}}},ut=s=>{const{target:n}=s,e=n&&t.closest(n,X),i=e&&f(e);// istanbul ignore else @preserve
if(i){s.stopPropagation(),i.toggle();// istanbul ignore else @preserve
e&&V(e)&&s.preventDefault()}},pt=s=>{// istanbul ignore else @preserve
[t.keyArrowDown,t.keyArrowUp].includes(s.code)&&s.preventDefault()};function ft(s){const{code:n}=s,e=D(this),i=e&&f(e),{activeElement:c}=e&&t.getDocument(e);// istanbul ignore else @preserve
if(i&&c){const{menu:o,open:r}=i,d=lt(o);if(d&&d.length&&[t.keyArrowDown,t.keyArrowUp].includes(n)){let u=d.indexOf(c);// istanbul ignore else @preserve
c===e?u=0:n===t.keyArrowUp?u=u>1?u-1:0:n===t.keyArrowDown&&(u=u<d.length-1?u+1:u);// istanbul ignore else @preserve
d[u]&&t.focus(d[u])}t.keyEscape===n&&r&&(i.toggle(),t.focus(e))}}function ht(s){const n=D(s),e=n&&f(n);// istanbul ignore else @preserve
e&&e.open&&Z(e)}class g extends it.BaseComponent{constructor(e,i){super(e,i);h(this,"_toggleEventListeners",e=>{(e?y.addListener:y.removeListener)(this.element,t.mouseclickEvent,ut)});const{parentElement:c}=this.element,[o]=t.getElementsByClassName(Q,c);o&&(this.parentElement=c,this.menu=o,this._observer=new IntersectionObserver(([r])=>ht(r.target),{threshold:1}),this._toggleEventListeners(!0))}get name(){return J}get defaults(){return at}toggle(){this.open?this.hide():this.show()}show(){const{element:e,open:i,menu:c,parentElement:o}=this;// istanbul ignore else @preserve
if(!i){const r=D(e),d=r&&f(r);d&&d.hide(),[T,W,Y].forEach(u=>{u.relatedTarget=e}),t.dispatchEvent(o,T),T.defaultPrevented||(t.addClass(c,m.showClass),t.addClass(o,m.showClass),t.setAttribute(e,t.ariaExpanded,"true"),Z(this),this.open=!i,t.focus(e),z(this),t.dispatchEvent(o,W))}}hide(){const{element:e,open:i,menu:c,parentElement:o}=this;// istanbul ignore else @preserve
i&&([$,R].forEach(r=>{r.relatedTarget=e}),t.dispatchEvent(o,$),$.defaultPrevented||(t.removeClass(c,m.showClass),t.removeClass(o,m.showClass),t.setAttribute(e,t.ariaExpanded,"false"),this.open=!i,z(this),t.dispatchEvent(o,R)))}dispose(){this.open&&this.hide(),this._toggleEventListeners(),super.dispose()}}h(g,"selector",X),h(g,"init",ct),h(g,"getInstance",f);module.exports=g;
//# sourceMappingURL=dropdown.cjs.map
